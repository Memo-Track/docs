<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(3)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Flutter App Docs | MemoTrack - docs</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Flutter App Docs" /> <meta property="og:locale" content="en_US" /> <meta property="og:site_name" content="MemoTrack - docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Flutter App Docs" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Flutter App Docs","url":"/flutter-app-docs.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> MemoTrack - docs </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Index</a></li><li class="nav-list-item"><a href="/backend-docs.html" class="nav-list-link">Backend Docs</a></li><li class="nav-list-item"><a href="/flutter-app-docs.html" class="nav-list-link">Flutter App Docs</a></li><li class="nav-list-item"><a href="/react-webview-frontend-docs.html" class="nav-list-link">React App Docs</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in User Manual category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/usermanual/" class="nav-list-link">User Manual</a><ul class="nav-list"><li class="nav-list-item"><a href="/usermanual/admin.html" class="nav-list-link">Admin Workflow</a></li><li class="nav-list-item"><a href="/usermanual/approver.html" class="nav-list-link">Approver Workflow</a></li><li class="nav-list-item"><a href="/usermanual/common.html" class="nav-list-link">Common Workflow</a></li><li class="nav-list-item"><a href="/usermanual/nurse.html" class="nav-list-link">Nurse Workflow</a></li></ul></li></ul> <div class="nav-category"></div> <ul class="nav-list"></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search MemoTrack - docs" aria-label="Search MemoTrack - docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <p>The MemoTrack Flutter application is designed as a <strong>comprehensive hospital management application</strong>, aimed at efficiently managing and tracking memos within a hospital setting.</p> <h3 id="app-specification-and-requirements"> <a href="#app-specification-and-requirements" class="anchor-heading" aria-labelledby="app-specification-and-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> App Specification and Requirements </h3> <ul> <li><strong>Application Name</strong>: The project is internally named <code class="language-plaintext highlighter-rouge">hospital_management</code> in <code class="language-plaintext highlighter-rouge">pubspec.yaml</code>, but the Android application label is <strong><code class="language-plaintext highlighter-rouge">MemoTrack</code></strong>, and its package name is <code class="language-plaintext highlighter-rouge">com.memotrack.myapp</code>.</li> <li><strong>Version</strong>: The application is at <strong>version 2.0.1+11</strong>.</li> <li><strong>Environment</strong>: It is built for <strong>Flutter SDK versions ‘&gt;=3.0.0 &lt;4.0.0’</strong>.</li> <li><strong>Core Functionality</strong>: <ul> <li>User authentication with role-based access.</li> <li>Management of hospital infrastructure elements like blocks and wards.</li> <li>Display and interaction with memos, potentially via an embedded web (React) application.</li> <li>Notifications via Firebase Cloud Messaging (FCM).</li> <li>Speech-to-text functionality for input.</li> <li>Image upload associated with memos.</li> </ul> </li> <li><strong>Firebase Integration</strong>: <ul> <li>Uses <strong>Firebase Core</strong>, <strong>Firebase Messaging</strong>, and <strong>Firebase Remote Config</strong>.</li> <li>The project ID is <strong><code class="language-plaintext highlighter-rouge">memo-track</code></strong>.</li> <li>Firebase Messaging is configured to handle foreground, background, and terminated state notifications using <code class="language-plaintext highlighter-rouge">flutter_local_notifications</code>.</li> <li>Remote Config is used to fetch dynamic configurations, including the backend and frontend (React) API URLs.</li> </ul> </li> <li><strong>API Communication</strong>: <ul> <li>Communicates with a backend API, with a <strong>base URL primarily configured via Firebase Remote Config</strong> (defaulting to <code class="language-plaintext highlighter-rouge">https://memotrack.pythonanywhere.com</code>).</li> <li>Supports various API endpoints for authentication, user management, hospital data, roles, blocks, shifts, wards, and memo operations (create, update, approve, reject, worker status).</li> </ul> </li> <li><strong>Frontend Integration (React)</strong>: <ul> <li>The app embeds a <strong>React web application using <code class="language-plaintext highlighter-rouge">webview_flutter</code></strong> to display complex UI, especially for memo lists and details.</li> <li>A JavaScript channel (<code class="language-plaintext highlighter-rouge">ReactToFlutter</code>) enables two-way communication between the Flutter app and the embedded React app for actions like updating user data or triggering image uploads.</li> <li>Another JavaScript channel (<code class="language-plaintext highlighter-rouge">SpeechToText</code>) is used to send speech recognition results and status to the React app.</li> <li>Authentication tokens and user data are injected into the WebView’s <code class="language-plaintext highlighter-rouge">localStorage</code> for the React app to utilise.</li> </ul> </li> <li><strong>Platform Specific Features</strong>: <ul> <li>Handles <code class="language-plaintext highlighter-rouge">tel:</code>, <code class="language-plaintext highlighter-rouge">sms:</code>, and <code class="language-plaintext highlighter-rouge">mailto:</code> URLs natively.</li> <li>Retrieves SIM card phone numbers using platform channels (<code class="language-plaintext highlighter-rouge">sim_info_channel</code>).</li> </ul> </li> <li><strong>Assets</strong>: Includes various images (<code class="language-plaintext highlighter-rouge">ic_launcher.png</code>, <code class="language-plaintext highlighter-rouge">app_logo.png</code>) and a Lottie animation (<code class="language-plaintext highlighter-rouge">no_internet.json</code>).</li> <li><strong>Build Automation</strong>: Utilises GitHub Actions for continuous integration, including building Android App Bundles (AAB) and APKs, and for manual production builds with configurable environment and API URLs.</li> </ul> <h3 id="dependencies-from-pubspecyaml"> <a href="#dependencies-from-pubspecyaml" class="anchor-heading" aria-labelledby="dependencies-from-pubspecyaml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dependencies from <code class="language-plaintext highlighter-rouge">pubspec.yaml</code> </h3> <ul> <li><strong>State Management</strong>: <code class="language-plaintext highlighter-rouge">provider</code></li> <li><strong>HTTP Requests</strong>: <code class="language-plaintext highlighter-rouge">http</code></li> <li><strong>Local Storage</strong>: <code class="language-plaintext highlighter-rouge">shared_preferences</code></li> <li><strong>UI Components</strong>: <code class="language-plaintext highlighter-rouge">cupertino_icons</code>, <code class="language-plaintext highlighter-rouge">webview_flutter</code>, <code class="language-plaintext highlighter-rouge">animated_text_kit</code>, <code class="language-plaintext highlighter-rouge">lottie</code></li> <li><strong>Notifications</strong>: <code class="language-plaintext highlighter-rouge">firebase_messaging</code>, <code class="language-plaintext highlighter-rouge">firebase_core</code>, <code class="language-plaintext highlighter-rouge">flutter_local_notifications</code></li> <li><strong>Permissions</strong>: <code class="language-plaintext highlighter-rouge">permission_handler</code></li> <li><strong>Voice Input</strong>: <code class="language-plaintext highlighter-rouge">speech_to_text</code>, <code class="language-plaintext highlighter-rouge">translator</code></li> <li><strong>Remote Configuration</strong>: <code class="language-plaintext highlighter-rouge">firebase_remote_config</code></li> <li><strong>Platform Integrations</strong>: <code class="language-plaintext highlighter-rouge">android_intent_plus</code>, <code class="language-plaintext highlighter-rouge">connectivity_plus</code>, <code class="language-plaintext highlighter-rouge">image_picker</code>, <code class="language-plaintext highlighter-rouge">path</code>, <code class="language-plaintext highlighter-rouge">url_launcher</code>, <code class="language-plaintext highlighter-rouge">package_info_plus</code></li> </ul> <h3 id="dev-dependencies-from-pubspecyaml"> <a href="#dev-dependencies-from-pubspecyaml" class="anchor-heading" aria-labelledby="dev-dependencies-from-pubspecyaml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dev Dependencies from <code class="language-plaintext highlighter-rouge">pubspec.yaml</code> </h3> <ul> <li><code class="language-plaintext highlighter-rouge">flutter_test</code></li> <li><code class="language-plaintext highlighter-rouge">flutter_lints</code></li> <li><code class="language-plaintext highlighter-rouge">flutter_launcher_icons</code></li> </ul><hr /> <h3 id="lib-directory-file-documentation"> <a href="#lib-directory-file-documentation" class="anchor-heading" aria-labelledby="lib-directory-file-documentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lib</code> Directory File Documentation </h3> <p>The <code class="language-plaintext highlighter-rouge">lib</code> directory is the heart of the Flutter application, containing all the Dart source code.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">lib/main.dart</code></strong> <ul> <li><strong>Purpose</strong>: This is the <strong>application’s entry point</strong>. It handles the initial setup including Firebase, Firebase Messaging for push notifications, remote configuration, and ensures essential notification permissions are requested. It then launches the main <code class="language-plaintext highlighter-rouge">MyApp</code> widget.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">main()</code>: Asynchronously initialises <code class="language-plaintext highlighter-rouge">WidgetsFlutterBinding</code>, Firebase, and sets up Firebase Messaging specifically for Android and iOS platforms.</li> <li><code class="language-plaintext highlighter-rouge">setupFirebaseMessaging()</code>: Configures <strong>FCM for the app</strong>, handling token retrieval, token refresh listeners, and setting up <code class="language-plaintext highlighter-rouge">flutter_local_notifications</code> to display foreground notifications and handle notification taps (routing to <code class="language-plaintext highlighter-rouge">MemoWebViewPage</code>).</li> <li><code class="language-plaintext highlighter-rouge">_firebaseMessagingBackgroundHandler()</code>: A crucial top-level function that ensures Firebase is initialised to process messages when the app is in the background.</li> <li><code class="language-plaintext highlighter-rouge">_handleMessage()</code>: Navigates the app to the <code class="language-plaintext highlighter-rouge">MemoWebViewPage</code> to display a specific memo when a notification containing a <code class="language-plaintext highlighter-rouge">memo_id</code> is tapped.</li> <li><code class="language-plaintext highlighter-rouge">MyApp</code>: The root widget, responsible for setting up the <code class="language-plaintext highlighter-rouge">AuthProvider</code> for global state management, defining the application’s material design theme (<code class="language-plaintext highlighter-rouge">AppTheme.lightTheme</code>), and designating <code class="language-plaintext highlighter-rouge">WelcomePage</code> as the initial screen.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/welcome.dart</code></strong> <ul> <li><strong>Purpose</strong>: Serves as the <strong>initial splash screen</strong>, presenting animated text while performing critical startup checks such as internet connectivity and necessary device permissions before navigating to the login or home screen.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">_WelcomePageState</code>: Manages <strong>animations</strong> (fade and slide) for the intro sequence.</li> <li><code class="language-plaintext highlighter-rouge">_handleStartupSequence()</code>: Orchestrates the asynchronous execution of internet connectivity checks, permission requests, and the authentication flow.</li> <li><code class="language-plaintext highlighter-rouge">_checkInternet()</code>: Verifies network availability using <code class="language-plaintext highlighter-rouge">connectivity_plus</code> and displays a <strong>Lottie animation (<code class="language-plaintext highlighter-rouge">no_internet.json</code>)</strong> if offline, providing options to retry or open network settings.</li> <li><code class="language-plaintext highlighter-rouge">_checkPermissions()</code>: Requests crucial permissions like <strong>microphone, storage, and phone</strong> needed for app functionality.</li> <li><code class="language-plaintext highlighter-rouge">_handleAuthAndRedirect()</code>: Utilises the <code class="language-plaintext highlighter-rouge">AuthProvider</code> to determine if a user is authenticated and directs them to <code class="language-plaintext highlighter-rouge">HomeWrapper</code> (if logged in) or <code class="language-plaintext highlighter-rouge">LoginScreen</code> (if not).</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/components/switch_dialogs.dart</code></strong> <ul> <li><strong>Purpose</strong>: Provides <strong>reusable Flutter dialogs for block and ward selection</strong>. These dialogs embed a <code class="language-plaintext highlighter-rouge">WebViewWidget</code> to render interactive HTML content fetched from the API, enabling a dynamic selection experience.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">BlockSelectionDialog</code>/<code class="language-plaintext highlighter-rouge">_BlockSelectionDialogState</code>: Displays a <code class="language-plaintext highlighter-rouge">WebViewWidget</code> to present a list of blocks. It fetches block data using <code class="language-plaintext highlighter-rouge">apiService.getBlocks</code> and communicates user selection back to Flutter via a <strong>JavaScript channel (<code class="language-plaintext highlighter-rouge">FlutterChannel</code>)</strong>.</li> <li><code class="language-plaintext highlighter-rouge">BlockSwitchingDialog</code>: A wrapper around <code class="language-plaintext highlighter-rouge">BlockSelectionDialog</code> that includes logic to call the <code class="language-plaintext highlighter-rouge">apiService.switchBlock</code> endpoint and display snackbar confirmations/errors upon successful or failed block switching.</li> <li><code class="language-plaintext highlighter-rouge">WardSelectionDialog</code>/<code class="language-plaintext highlighter-rouge">_WardSelectionDialogState</code>: Functions identically to <code class="language-plaintext highlighter-rouge">BlockSelectionDialog</code> but is tailored for ward selection, fetching data using <code class="language-plaintext highlighter-rouge">apiService.getWards</code>.</li> <li><code class="language-plaintext highlighter-rouge">WardSwitchingDialog</code>: A wrapper for <code class="language-plaintext highlighter-rouge">WardSelectionDialog</code> that integrates the <code class="language-plaintext highlighter-rouge">apiService.switchWard</code> functionality.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/core/theme/app_theme.dart</code></strong> <ul> <li><strong>Purpose</strong>: Centralises the <strong>visual styling and theming</strong> for the entire application, ensuring a consistent look and feel across all screens.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">AppFontSizes</code>: Defines a set of static font size constants.</li> <li><code class="language-plaintext highlighter-rouge">AppTheme</code>: Provides the <code class="language-plaintext highlighter-rouge">lightTheme</code> configuration, which leverages <code class="language-plaintext highlighter-rouge">Material3</code> and customises <code class="language-plaintext highlighter-rouge">ColorScheme</code>, <code class="language-plaintext highlighter-rouge">scaffoldBackgroundColor</code>, <code class="language-plaintext highlighter-rouge">appBarTheme</code>, <code class="language-plaintext highlighter-rouge">cardTheme</code>, <code class="language-plaintext highlighter-rouge">elevatedButtonTheme</code>, <code class="language-plaintext highlighter-rouge">outlinedButtonTheme</code>, <code class="language-plaintext highlighter-rouge">textButtonTheme</code>, <code class="language-plaintext highlighter-rouge">inputDecorationTheme</code>, <code class="language-plaintext highlighter-rouge">drawerTheme</code>, <code class="language-plaintext highlighter-rouge">listTileTheme</code>, and <code class="language-plaintext highlighter-rouge">textTheme</code> using a defined palette of colours and font sizes.</li> <li><code class="language-plaintext highlighter-rouge">AppSpacing</code> and <code class="language-plaintext highlighter-rouge">AppRadius</code>: Static constants for consistent padding, margins, and border radii.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/models/auth_response.dart</code></strong> <ul> <li><strong>Purpose</strong>: Defines Dart classes for <strong>parsing authentication responses</strong> from the API and for representing block data.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">AuthResponse</code>: A model class holding the <code class="language-plaintext highlighter-rouge">token</code>, <code class="language-plaintext highlighter-rouge">User</code>, and <code class="language-plaintext highlighter-rouge">Hospital</code> objects received post-login, with <code class="language-plaintext highlighter-rouge">fromJson</code> and <code class="language-plaintext highlighter-rouge">toJson</code> methods for serialization.</li> <li><code class="language-plaintext highlighter-rouge">Block</code>: A simple data model for a block, containing its <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">description</code>, and <code class="language-plaintext highlighter-rouge">hospitalId</code>.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/models/hospital.dart</code></strong> <ul> <li><strong>Purpose</strong>: Defines the <strong>data structure for a Hospital object</strong>, including its geographical and contact information.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">Hospital</code>: Model class with fields for <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">geolocationPoint</code>, <code class="language-plaintext highlighter-rouge">radius</code>, and <code class="language-plaintext highlighter-rouge">address</code>, complete with <code class="language-plaintext highlighter-rouge">fromJson</code> and <code class="language-plaintext highlighter-rouge">toJson</code> methods.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/models/hospital_models.dart</code></strong> <ul> <li><strong>Purpose</strong>: Provides <strong>specific data models for hospital infrastructure elements</strong>, such as blocks and wards, distinct from the generic <code class="language-plaintext highlighter-rouge">Block</code> model in <code class="language-plaintext highlighter-rouge">auth_response.dart</code>.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">HospitalBlock</code>: Models a block with <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">noOfFloors</code>, and <code class="language-plaintext highlighter-rouge">hospitalId</code>. Includes robust <code class="language-plaintext highlighter-rouge">fromJson</code> parsing.</li> <li><code class="language-plaintext highlighter-rouge">HospitalWard</code>: Models a ward with <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">block</code> (ID), <code class="language-plaintext highlighter-rouge">floor</code>, and <code class="language-plaintext highlighter-rouge">hospitalId</code>, also with <code class="language-plaintext highlighter-rouge">fromJson</code> parsing.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/models/toast_model.dart</code></strong> <ul> <li><strong>Purpose</strong>: Offers a utility to <strong>display custom, top-positioned toast messages</strong> (e.g., for success or error notifications) without relying on external packages.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">showTopToast()</code>: A function that creates a temporary <code class="language-plaintext highlighter-rouge">OverlayEntry</code> to display a custom <code class="language-plaintext highlighter-rouge">SnackBar</code>-like message, fading out after a set duration.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/models/user.dart</code></strong> <ul> <li><strong>Purpose</strong>: Defines the <strong>comprehensive data model for a user</strong> within the application, including their personal details, roles, and current operational context.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">User</code>: A model with extensive fields such as <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">institutionId</code>, <code class="language-plaintext highlighter-rouge">role</code>, <code class="language-plaintext highlighter-rouge">phoneNumber</code>, FCM tokens, current block/ward/floor, hospital ID, and <strong>role-based boolean flags</strong> like <code class="language-plaintext highlighter-rouge">isApprover</code>, <code class="language-plaintext highlighter-rouge">isSuperuser</code>, <code class="language-plaintext highlighter-rouge">isResponder</code>, <code class="language-plaintext highlighter-rouge">isCreator</code>.</li> <li><code class="language-plaintext highlighter-rouge">fromJson()</code>: Factory constructor for instantiating a <code class="language-plaintext highlighter-rouge">User</code> object from a JSON map.</li> <li><code class="language-plaintext highlighter-rouge">copyWith()</code>: Provides a convenient way to create a new <code class="language-plaintext highlighter-rouge">User</code> instance with some fields updated while others remain the same.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/providers/auth_provider.dart</code></strong> <ul> <li><strong>Purpose</strong>: Manages the <strong>global authentication state</strong> of the user using the Provider package, ensuring user and hospital data persist across sessions via <code class="language-plaintext highlighter-rouge">shared_preferences</code>.</li> <li><strong>Key Contents</strong>: <ul> <li>Private fields: <code class="language-plaintext highlighter-rouge">_user</code>, <code class="language-plaintext highlighter-rouge">_hospital</code>, <code class="language-plaintext highlighter-rouge">_token</code>, <code class="language-plaintext highlighter-rouge">_isLoading</code>, <code class="language-plaintext highlighter-rouge">_error</code> store the current authentication state.</li> <li>Getters: Provide access to boolean flags reflecting the user’s roles (<code class="language-plaintext highlighter-rouge">isSuperuser</code>, <code class="language-plaintext highlighter-rouge">isApprover</code>, <code class="language-plaintext highlighter-rouge">isResponder</code>, <code class="language-plaintext highlighter-rouge">isCreator</code>).</li> <li><code class="language-plaintext highlighter-rouge">initializeAuth()</code>: Loads previously saved authentication data from <code class="language-plaintext highlighter-rouge">SharedPreferences</code> when the app starts.</li> <li><code class="language-plaintext highlighter-rouge">login()</code>, <code class="language-plaintext highlighter-rouge">setPassword()</code>, <code class="language-plaintext highlighter-rouge">logout()</code>: Methods to handle authentication operations by interacting with <code class="language-plaintext highlighter-rouge">ApiService</code> and managing the local authentication state.</li> <li><code class="language-plaintext highlighter-rouge">updateFCMToken()</code>, <code class="language-plaintext highlighter-rouge">updateCurrentBlock()</code>, <code class="language-plaintext highlighter-rouge">updateCurrentWard()</code>: Update user-specific data both locally and on the backend.</li> <li><code class="language-plaintext highlighter-rouge">_saveAuthData()</code>, <code class="language-plaintext highlighter-rouge">_saveUserData()</code>: Helper methods to persist authentication and user data to <code class="language-plaintext highlighter-rouge">SharedPreferences</code>.</li> <li><code class="language-plaintext highlighter-rouge">parseApiError()</code>: A utility to extract and format readable error messages from API responses.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/block_selection_screen.dart</code></strong> <ul> <li><strong>Purpose</strong>: A screen that allows a user (specifically approvers, based on the <code class="language-plaintext highlighter-rouge">HomeWrapper</code> logic) to <strong>select their current working block</strong>, which then updates their profile and redirects them.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">_BlockSelectionScreenState</code>: Manages the selected block’s ID and name, lists available blocks, and handles loading/error states.</li> <li><code class="language-plaintext highlighter-rouge">_loadBlocks()</code>: Fetches the list of blocks from the <code class="language-plaintext highlighter-rouge">ApiService</code> for the user’s hospital.</li> <li><code class="language-plaintext highlighter-rouge">_submit()</code>: Calls <code class="language-plaintext highlighter-rouge">ApiService().updateUser</code> and <code class="language-plaintext highlighter-rouge">ApiService().switchBlock</code> to update the user’s block on the backend, then updates the <code class="language-plaintext highlighter-rouge">AuthProvider</code> and navigates the user accordingly (either back to the dashboard or to the <code class="language-plaintext highlighter-rouge">HomeWrapper</code>).</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/main_navigation.dart</code></strong> <ul> <li><strong>Purpose</strong>: Implements the <strong>main bottom navigation</strong> structure of the app, allowing users to switch between different sections (Dashboard, Memos). It also ensures that deep links from notifications navigate to the correct memo page.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">_navigatorKeys</code>: A list of <code class="language-plaintext highlighter-rouge">GlobalKey</code>s, each associated with a separate <code class="language-plaintext highlighter-rouge">Navigator</code> for independent navigation stacks within each tab.</li> <li><code class="language-plaintext highlighter-rouge">_selectedIndex</code>: Tracks the currently active tab.</li> <li><code class="language-plaintext highlighter-rouge">_redirectToMemo()</code>: Specifically handles navigation to a <code class="language-plaintext highlighter-rouge">MemoWebViewPage</code> with a given <code class="language-plaintext highlighter-rouge">memoId</code>, typically invoked when a push notification is tapped.</li> <li><code class="language-plaintext highlighter-rouge">_onItemTapped()</code>: Manages tab switching and popping to the root of a tab’s navigation stack if the same tab is re-tapped.</li> <li><code class="language-plaintext highlighter-rouge">PopScope</code>: Controls the app’s back button behaviour, popping routes within the current tab or switching to the first tab if no more routes are available.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/memo_list_page.dart</code></strong> <ul> <li><strong>Purpose</strong>: Displays a <strong>searchable, filterable, and sortable list of memos</strong>, providing a user-friendly interface for managing maintenance requests.</li> <li><strong>Key Contents</strong>: <ul> <li>State variables: <code class="language-plaintext highlighter-rouge">_allMemos</code>, <code class="language-plaintext highlighter-rouge">_filteredMemos</code>, <code class="language-plaintext highlighter-rouge">_searchQuery</code>, <code class="language-plaintext highlighter-rouge">_selectedDepartment</code>, <code class="language-plaintext highlighter-rouge">_sortBy</code>, <code class="language-plaintext highlighter-rouge">_sortAscending</code>, <code class="language-plaintext highlighter-rouge">_currentPage</code>, <code class="language-plaintext highlighter-rouge">_departments</code> manage memo data, filters, and pagination.</li> <li><code class="language-plaintext highlighter-rouge">_loadMemos()</code>: Fetches memos from the <code class="language-plaintext highlighter-rouge">ApiService</code> and populates the lists, also extracting unique departments for filtering.</li> <li><code class="language-plaintext highlighter-rouge">_applyFiltersAndSearch()</code>: Applies the active search query, department filter, and sorting order to the memo list.</li> <li><code class="language-plaintext highlighter-rouge">_paginatedMemos</code>: A getter that provides the subset of memos for the current page.</li> <li><code class="language-plaintext highlighter-rouge">_showFilterBottomSheet()</code>: Presents a modal bottom sheet (<code class="language-plaintext highlighter-rouge">_FilterBottomSheet</code>) for users to interact with filtering and sorting options.</li> <li>UI: Features an <code class="language-plaintext highlighter-rouge">AppBar</code> with filter and refresh actions, a persistent search bar, filter summary chips, memo count, and paginated list of memo cards.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/memo_web_page.dart</code></strong> <ul> <li><strong>Purpose</strong>: <strong>Embeds the React-based memo management interface</strong> as a <code class="language-plaintext highlighter-rouge">WebViewWidget</code> within the Flutter application. It serves as the primary bridge for deep interaction between the native Flutter environment and the web frontend.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">WebViewController _controller</code>: The core component for managing the WebView, enabling JavaScript execution, handling navigation requests (like <code class="language-plaintext highlighter-rouge">tel:</code>, <code class="language-plaintext highlighter-rouge">sms:</code>, <code class="language-plaintext highlighter-rouge">mailto:</code> URLs are opened natively), and managing communication channels.</li> <li><code class="language-plaintext highlighter-rouge">reactUrl</code>: The URL of the React frontend application, obtained from <code class="language-plaintext highlighter-rouge">RemoteConfigService</code>.</li> <li><strong>Speech-to-text integration</strong>: Includes setup for <code class="language-plaintext highlighter-rouge">SpeechToText</code> (requesting microphone permission, initialising <code class="language-plaintext highlighter-rouge">SpeechToText</code>, managing locales like Tamil and English), and methods (<code class="language-plaintext highlighter-rouge">_startListening</code>, <code class="language-plaintext highlighter-rouge">_stopListening</code>, <code class="language-plaintext highlighter-rouge">_changeLanguage</code>) to send <strong>real-time speech results and status back to the React app</strong> via the <code class="language-plaintext highlighter-rouge">SpeechToText</code> JavaScript channel.</li> <li><code class="language-plaintext highlighter-rouge">_injectUserData()</code>: A crucial method that injects the Flutter app’s <strong>authentication token, user data, hospital data, and Flutter app version into the WebView’s <code class="language-plaintext highlighter-rouge">localStorage</code></strong>, making it accessible to the React frontend.</li> <li><code class="language-plaintext highlighter-rouge">_handleReactMessage()</code>: Listens for messages sent from the React app via the <code class="language-plaintext highlighter-rouge">ReactToFlutter</code> JavaScript channel. It handles actions like <code class="language-plaintext highlighter-rouge">updateUser</code> (to update the native Flutter user state) and <code class="language-plaintext highlighter-rouge">uploadImage</code> (to navigate to the native image upload screen).</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/splash_screen.dart</code></strong> <ul> <li><strong>Purpose</strong>: This file is <strong>commented out</strong> in the provided source code, indicating it’s likely an <strong>older or alternative splash screen implementation</strong>. Its original intent was to handle initial app loading, authentication checks, and navigation. This functionality appears to have been superseded by <code class="language-plaintext highlighter-rouge">lib/welcome.dart</code>.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/upload_memo_image.dart</code></strong> <ul> <li><strong>Purpose</strong>: Provides a dedicated screen for <strong>users to capture or select an image and upload it</strong>, associating it with a specific memo.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">memoId</code>: The identifier for the memo to which the image will be linked.</li> <li><code class="language-plaintext highlighter-rouge">_pickImage()</code>: Uses the <code class="language-plaintext highlighter-rouge">image_picker</code> package to allow users to choose an image from their camera or photo gallery.</li> <li><code class="language-plaintext highlighter-rouge">_uploadImage()</code>: Handles the actual image upload using <code class="language-plaintext highlighter-rouge">http.MultipartRequest</code>, sending the image along with <code class="language-plaintext highlighter-rouge">memo_id</code>, <code class="language-plaintext highlighter-rouge">user_id</code>, and <code class="language-plaintext highlighter-rouge">user_name</code> as headers to a specified API endpoint (<code class="language-plaintext highlighter-rouge">https://memo-track.free.beeceptor.com/api/img</code>).</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/ward_selection_screen.dart</code></strong> <ul> <li><strong>Purpose</strong>: Enables users to <strong>select their current working ward</strong>, with wards organized by block and floor for easier navigation and selection. It supports searching and filtering.</li> <li><strong>Key Contents</strong>: <ul> <li>Data structures: <code class="language-plaintext highlighter-rouge">allWards</code>, <code class="language-plaintext highlighter-rouge">wardsByBlock</code>, <code class="language-plaintext highlighter-rouge">blockNames</code> manage the ward data and its organization.</li> <li><code class="language-plaintext highlighter-rouge">_loadWards()</code>: Fetches ward data from the <code class="language-plaintext highlighter-rouge">ApiService</code>.</li> <li><code class="language-plaintext highlighter-rouge">_organizeWardsByBlock()</code>: Groups wards by their associated block and sorts them for display.</li> <li><code class="language-plaintext highlighter-rouge">_filterWards()</code>: Updates the displayed list of wards based on a user’s search query.</li> <li><code class="language-plaintext highlighter-rouge">_submit()</code>: Updates the user’s selected ward on the backend via <code class="language-plaintext highlighter-rouge">ApiService</code> and updates the <code class="language-plaintext highlighter-rouge">AuthProvider</code>’s state.</li> <li>UI: Features a search bar, expandable <code class="language-plaintext highlighter-rouge">ExpansionTile</code> widgets for each block, and <code class="language-plaintext highlighter-rouge">ListTile</code>s for individual wards, allowing selection via radio buttons.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/auth/login_screen.dart</code></strong> <ul> <li><strong>Purpose</strong>: Provides the <strong>user login interface and logic</strong>, including phone number and password input, form validation, and navigation after successful authentication.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">_formKey</code>: Used for form validation.</li> <li><code class="language-plaintext highlighter-rouge">_phoneController</code>, <code class="language-plaintext highlighter-rouge">_passwordController</code>: Text controllers for the input fields.</li> <li><code class="language-plaintext highlighter-rouge">_checkConnectivityAndPermissions()</code>: Ensures the device has internet access and necessary permissions before attempting login.</li> <li><code class="language-plaintext highlighter-rouge">_login()</code>: Calls <code class="language-plaintext highlighter-rouge">authProvider.login</code> with user credentials. Upon success, it navigates to <code class="language-plaintext highlighter-rouge">BlockSelectionScreen</code> (for approvers) or <code class="language-plaintext highlighter-rouge">HomeWrapper</code> (for others). On failure, it uses <code class="language-plaintext highlighter-rouge">showTopToast</code> to display an error message.</li> <li><code class="language-plaintext highlighter-rouge">_navigateToSetPassword()</code>: Directs the user to the <code class="language-plaintext highlighter-rouge">SetPasswordScreen</code>.</li> <li>UI: Displays the app logo, title, a login form with phone number and password fields (including a password visibility toggle), and action buttons for login and setting a new password.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/auth/set_password_screen.dart</code></strong> <ul> <li><strong>Purpose</strong>: Enables users to <strong>set or reset their account password</strong> using their phone number, with an integrated feature to pick phone numbers directly from the device’s SIM cards.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">_formKey</code>: For form validation.</li> <li><code class="language-plaintext highlighter-rouge">_phoneController</code>, <code class="language-plaintext highlighter-rouge">_passwordController</code>, <code class="language-plaintext highlighter-rouge">_confirmPasswordController</code>: Controllers for input fields.</li> <li><code class="language-plaintext highlighter-rouge">_setPassword()</code>: Calls <code class="language-plaintext highlighter-rouge">authProvider.setPassword</code> to update the password on the backend. Navigates to <code class="language-plaintext highlighter-rouge">HomeWrapper</code> on success or displays an error toast.</li> <li><code class="language-plaintext highlighter-rouge">_selectSimNumber()</code>: Requests phone permissions and then uses <code class="language-plaintext highlighter-rouge">SimService.getSimNumbers()</code> to fetch and display available SIM card numbers for selection in a bottom sheet.</li> <li><code class="language-plaintext highlighter-rouge">_removeCountryCode()</code>: A helper function to clean up phone numbers obtained from SIM cards by removing country codes.</li> <li>UI: Contains input fields for phone number (with SIM selection), new password, and confirm password (both with visibility toggles), along with buttons to set the password.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/home/admin_home_screen.dart</code></strong> <ul> <li><strong>Purpose</strong>: (Partially implemented) Intended as an <strong>administrative home screen</strong> featuring a dashboard and a navigation drawer for various administrative sections.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">_selectedIndex</code>, <code class="language-plaintext highlighter-rouge">_screens</code>, <code class="language-plaintext highlighter-rouge">_navigationItems</code>: Manage which screen is currently displayed and define the drawer navigation options.</li> <li><code class="language-plaintext highlighter-rouge">_buildDrawer()</code>: Constructs the app’s navigation drawer with a header and list tiles for different sections (e.g., Dashboard, Users, Profile). The “Users” and “Profile” sections are commented out but indicate planned functionality.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/home/block_selection_screen.dart</code></strong> <ul> <li><strong>Purpose</strong>: This file is <strong>commented out</strong> and represents an <strong>alternative or deprecated implementation</strong> for block selection within the home modules. The active implementation for block selection is located at <code class="language-plaintext highlighter-rouge">lib/screens/block_selection_screen.dart</code>.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/home/dashboard_screen.dart</code></strong> <ul> <li><strong>Purpose</strong>: Displays the <strong>primary dashboard</strong> for authenticated users, presenting a summary of user information, hospital details, current location (block/ward), and assigned permissions. It also provides options for relevant actions like switching locations or logging out.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">_showBlockSwitchingForm()</code>: Directs to the <code class="language-plaintext highlighter-rouge">BlockSelectionScreen</code> (the active one) for users to change their current block.</li> <li><code class="language-plaintext highlighter-rouge">_showWardSwitchingForm()</code>: Directs to the <code class="language-plaintext highlighter-rouge">WardSelectionScreen</code> for users to change their current ward.</li> <li><code class="language-plaintext highlighter-rouge">_buildPermissionChip()</code>: A helper function to visually represent user permissions (Superuser, Approver, Responder, Creator) as chips.</li> <li><code class="language-plaintext highlighter-rouge">_showLogoutDialog()</code>: Presents a confirmation dialog for user logout.</li> <li>UI: Organised into cards, it displays a welcome message with user ID and role, hospital name and address, current block and ward (if set), and a dynamic section for block/ward switching buttons based on the user’s roles. A “Permissions” section clearly lists all assigned roles.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/screens/home/home_wrapper.dart</code></strong> <ul> <li><strong>Purpose</strong>: Acts as an <strong>intermediary screen after authentication</strong> to direct the user to the appropriate starting point in the application based on their role and current state.</li> <li><strong>Key Contents</strong>: <ul> <li>Conditional Navigation: <ul> <li>If no user is authenticated, it renders <code class="language-plaintext highlighter-rouge">LoginScreen</code>.</li> <li>If the user is an approver (<code class="language-plaintext highlighter-rouge">auth.isApprover</code>) and has no <code class="language-plaintext highlighter-rouge">currentBlockId</code> set, it directs them to the <code class="language-plaintext highlighter-rouge">BlockSelectionScreen</code> to select a block.</li> <li>Otherwise (for all other authenticated users or approvers with a block set), it displays the <code class="language-plaintext highlighter-rouge">MainNavigation</code> widget, which contains the main app tabs.</li> </ul> </li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/services/api_service.dart</code></strong> <ul> <li><strong>Purpose</strong>: Provides a <strong>centralized interface for all interactions with the backend API</strong>, handling HTTP requests, authentication token management, and response parsing. It uses a singleton pattern to ensure a single instance throughout the app.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">baseURL</code>: A static variable that holds the API’s base URL, dynamically set from <code class="language-plaintext highlighter-rouge">RemoteConfigService</code> during initialisation.</li> <li>Singleton Pattern: <code class="language-plaintext highlighter-rouge">ApiService._internal()</code> and <code class="language-plaintext highlighter-rouge">factory ApiService()</code> ensure only one instance is created.</li> <li><code class="language-plaintext highlighter-rouge">_getToken()</code>, <code class="language-plaintext highlighter-rouge">_getHeaders()</code>: Private methods for retrieving the authentication token from <code class="language-plaintext highlighter-rouge">SharedPreferences</code> and constructing HTTP request headers.</li> <li><code class="language-plaintext highlighter-rouge">_makeRequest()</code>, <code class="language-plaintext highlighter-rouge">_makeListRequest()</code>: Generic private methods that abstract the HTTP request logic (GET, POST, PATCH, DELETE) for single object and list responses, respectively. They handle status codes and JSON decoding, throwing exceptions for errors.</li> <li><strong>Public API Methods</strong>: A comprehensive set of methods covering all API interactions, including: <ul> <li>Authentication: <code class="language-plaintext highlighter-rouge">login()</code>, <code class="language-plaintext highlighter-rouge">setPassword()</code>, <code class="language-plaintext highlighter-rouge">logout()</code>.</li> <li>User/Hospital Data: <code class="language-plaintext highlighter-rouge">getHospital()</code>, <code class="language-plaintext highlighter-rouge">updateFCMToken()</code>, <code class="language-plaintext highlighter-rouge">getUser()</code>, <code class="language-plaintext highlighter-rouge">getUsers()</code>, <code class="language-plaintext highlighter-rouge">createUser()</code>, <code class="language-plaintext highlighter-rouge">updateUser()</code>, <code class="language-plaintext highlighter-rouge">deleteUser()</code>.</li> <li>Role Management: <code class="language-plaintext highlighter-rouge">getRoles()</code>, <code class="language-plaintext highlighter-rouge">createRole()</code>, <code class="language-plaintext highlighter-rouge">updateRole()</code>, <code class="language-plaintext highlighter-rouge">deleteRole()</code>.</li> <li>Infrastructure Management: <code class="language-plaintext highlighter-rouge">getBlocks()</code>, <code class="language-plaintext highlighter-rouge">createBlock()</code>, <code class="language-plaintext highlighter-rouge">updateBlock()</code>, <code class="language-plaintext highlighter-rouge">deleteBlock()</code>, <code class="language-plaintext highlighter-rouge">getShifts()</code>, <code class="language-plaintext highlighter-rouge">createShift()</code>, <code class="language-plaintext highlighter-rouge">updateShift()</code>, <code class="language-plaintext highlighter-rouge">deleteShift()</code>, <code class="language-plaintext highlighter-rouge">getWards()</code>.</li> <li>Location Switching: <code class="language-plaintext highlighter-rouge">switchBlock()</code>, <code class="language-plaintext highlighter-rouge">switchWard()</code>.</li> <li>Memo Operations: <code class="language-plaintext highlighter-rouge">getMemos()</code> (list), <code class="language-plaintext highlighter-rouge">createMemo()</code>, <code class="language-plaintext highlighter-rouge">updateMemo()</code>, <code class="language-plaintext highlighter-rouge">approveMemo()</code>, <code class="language-plaintext highlighter-rouge">rejectMemo()</code>, <code class="language-plaintext highlighter-rouge">addWorkerStatus()</code>, <code class="language-plaintext highlighter-rouge">deleteWorkerStatus()</code>, <code class="language-plaintext highlighter-rouge">refreshOTP()</code>.</li> </ul> </li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/services/fcm_token.dart</code></strong> <ul> <li><strong>Purpose</strong>: Provides a utility function specifically for <strong>retrieving the Firebase Cloud Messaging (FCM) device token</strong>.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">getFCMToken()</code>: Asynchronously fetches the FCM token using <code class="language-plaintext highlighter-rouge">FirebaseMessaging.instance.getToken()</code>. It ensures this operation is performed only on mobile platforms (Android/iOS) and handles potential errors during token retrieval.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/services/remote_config_service.dart</code></strong> <ul> <li><strong>Purpose</strong>: Implements a singleton service for <strong>fetching and providing dynamic configuration values</strong> from Firebase Remote Config.</li> <li><strong>Key Contents</strong>: <ul> <li>Singleton Pattern: Ensures only one instance of <code class="language-plaintext highlighter-rouge">RemoteConfigService</code> is used throughout the app.</li> <li><code class="language-plaintext highlighter-rouge">initialize()</code>: Configures <code class="language-plaintext highlighter-rouge">FirebaseRemoteConfig</code> settings (e.g., fetch timeout, minimum fetch interval) and then fetches and activates the latest configuration values.</li> <li>Getters: Provides convenient methods (<code class="language-plaintext highlighter-rouge">getString</code>, <code class="language-plaintext highlighter-rouge">getInt</code>, <code class="language-plaintext highlighter-rouge">getBool</code>, <code class="language-plaintext highlighter-rouge">getDouble</code>) to retrieve configured values by their keys, with options for default values if a key is not found.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">lib/services/sim_service.dart</code></strong> <ul> <li><strong>Purpose</strong>: Acts as a <strong>platform-specific service</strong> to retrieve phone numbers associated with the device’s SIM cards using a MethodChannel.</li> <li><strong>Key Contents</strong>: <ul> <li><code class="language-plaintext highlighter-rouge">_channel</code>: A <code class="language-plaintext highlighter-rouge">MethodChannel</code> named <code class="language-plaintext highlighter-rouge">sim_info_channel</code> that facilitates communication with native Android code.</li> <li><code class="language-plaintext highlighter-rouge">getSimNumbers()</code>: Invokes the native <code class="language-plaintext highlighter-rouge">getSimNumbers</code> method. It includes error handling for permission denials or if no SIM numbers are available, throwing an exception to the Dart side. (The corresponding native implementation is in <code class="language-plaintext highlighter-rouge">MainActivity.kt</code> in the Android project).</li> </ul> </li> </ul> </li> </ul> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
