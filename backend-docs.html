<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(2) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Backend Docs | MemoTrack - docs</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Backend Docs" /> <meta property="og:locale" content="en_US" /> <meta property="og:site_name" content="MemoTrack - docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Backend Docs" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Backend Docs","url":"/backend-docs.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> MemoTrack - docs </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Index</a></li><li class="nav-list-item"><a href="/backend-docs.html" class="nav-list-link">Backend Docs</a></li><li class="nav-list-item"><a href="/flutter-app-docs.html" class="nav-list-link">Flutter App Docs</a></li><li class="nav-list-item"><a href="/react-webview-frontend-docs.html" class="nav-list-link">React App Docs</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in User Manual category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/usermanual/" class="nav-list-link">User Manual</a><ul class="nav-list"><li class="nav-list-item"><a href="/usermanual/admin.html" class="nav-list-link">Admin Workflow</a></li><li class="nav-list-item"><a href="/usermanual/approver.html" class="nav-list-link">Approver Workflow</a></li><li class="nav-list-item"><a href="/usermanual/common.html" class="nav-list-link">Common Workflow</a></li><li class="nav-list-item"><a href="/usermanual/nurse.html" class="nav-list-link">Nurse Workflow</a></li></ul></li></ul> <div class="nav-category"></div> <ul class="nav-list"></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search MemoTrack - docs" aria-label="Search MemoTrack - docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <p>The <code class="language-plaintext highlighter-rouge">backend</code> directory houses the core Django application for MemoTrack-SAAS, designed for various hospitals. It includes several Django apps, configuration files, and static content.</p> <p>Here’s a breakdown of each file and its purpose:</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">manage.py</code></strong>: <ul> <li>This is Django’s command-line utility for administrative tasks.</li> <li>It sets the default port for the runserver command to <strong><code class="language-plaintext highlighter-rouge">30000</code></strong>.</li> <li>It ensures the <code class="language-plaintext highlighter-rouge">DJANGO_SETTINGS_MODULE</code> environment variable is set to <code class="language-plaintext highlighter-rouge">core.settings</code> before executing commands.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">requirements.txt</code></strong>: This is a binary file, which would typically list the Python dependencies required for the backend application.</li> </ul> <h3 id="backendaccounts"> <a href="#backendaccounts" class="anchor-heading" aria-labelledby="backendaccounts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/accounts/</code> </h3> <p>This Django app handles user accounts, roles, and hospital management.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">__init__.py</code></strong>: An empty file that signifies the <code class="language-plaintext highlighter-rouge">accounts</code> directory is a Python package.</li> <li><strong><code class="language-plaintext highlighter-rouge">admin.py</code></strong>: <ul> <li>Configures Django Admin to display <code class="language-plaintext highlighter-rouge">User</code> and <code class="language-plaintext highlighter-rouge">Hospital</code> models.</li> <li><strong><code class="language-plaintext highlighter-rouge">HospitalAdmin</code></strong>: Controls the queryset for hospitals in the admin panel; superusers can see all hospitals, while other users only see hospitals they are associated with.</li> <li><strong><code class="language-plaintext highlighter-rouge">UserAdmin</code></strong>: Controls the queryset for users; superusers see all users, while other users only see users belonging to their hospital.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">apps.py</code></strong>: <ul> <li>Defines the <code class="language-plaintext highlighter-rouge">AccountsConfig</code> for the <code class="language-plaintext highlighter-rouge">accounts</code> app.</li> <li>It sets <code class="language-plaintext highlighter-rouge">default_auto_field</code> to <code class="language-plaintext highlighter-rouge">django.db.models.BigAutoField</code>.</li> <li>The <code class="language-plaintext highlighter-rouge">ready</code> method ensures that signal handlers defined in <code class="language-plaintext highlighter-rouge">accounts.signals</code> are imported and registered when the app is ready.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">auth_backends.py</code></strong>: An empty file, which could be used for custom authentication backends.</li> <li><strong><code class="language-plaintext highlighter-rouge">fcm_service.py</code></strong>: <ul> <li>Handles Firebase Cloud Messaging (FCM) functionalities.</li> <li><strong>Initialisation</strong>: It initialises the Firebase Admin SDK using a service account key located at <code class="language-plaintext highlighter-rouge">memo-track-firebase-adminsdk-fbsvc-060fb4e2e6.json</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">send_fcm_to_user(token, title, body, data)</code></strong>: Sends a single FCM notification to a specific device token.</li> <li><strong><code class="language-plaintext highlighter-rouge">send_fcm_to_users(tokens, title, body, data)</code></strong>: Sends FCM notifications to a list of device tokens, returning success/failure counts and a list of failed tokens.</li> <li><strong><code class="language-plaintext highlighter-rouge">memo_created_notification(info, memoId)</code></strong>: Sends a notification when a new memo is created, targeting approvers and responders based on current block and tagged role, respectively.</li> <li><strong><code class="language-plaintext highlighter-rouge">memo_tagged_notification(info, tagged_role_name, tagged_role_id, memoId)</code></strong>: Sends a notification when a memo is tagged to a specific role.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">memo-track-firebase-adminsdk-fbsvc-060fb4e2e6.json</code></strong>: <ul> <li>This JSON file contains the Firebase service account credentials for the “memo-track” project.</li> <li>It includes the project ID (<code class="language-plaintext highlighter-rouge">memo-track</code>), private key ID, the private key itself, client email, client ID, and various Google API URLs for authentication and token exchange.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">models.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">Role</code></strong>: <ul> <li>Defines user roles within a <code class="language-plaintext highlighter-rouge">Hospital</code>.</li> <li>Fields include <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">description</code>, <code class="language-plaintext highlighter-rouge">is_protected</code> (prevents deletion), <code class="language-plaintext highlighter-rouge">is_approver</code>, <code class="language-plaintext highlighter-rouge">is_responder</code>, and <code class="language-plaintext highlighter-rouge">is_creator</code>.</li> <li>Roles are unique by <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">hospital</code>.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">Hospital</code></strong>: <ul> <li>Represents a hospital entity.</li> <li>Fields include <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">address</code>, <code class="language-plaintext highlighter-rouge">geolocation_point</code> (as latitude, longitude), <code class="language-plaintext highlighter-rouge">radius</code> (in meters), <code class="language-plaintext highlighter-rouge">created_at</code>, <code class="language-plaintext highlighter-rouge">updated_at</code>.</li> <li>It tracks <code class="language-plaintext highlighter-rouge">geolocation_changes</code> when the <code class="language-plaintext highlighter-rouge">geolocation_point</code> is updated.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">UserManager</code></strong>: A custom manager for the <code class="language-plaintext highlighter-rouge">User</code> model, used for creating regular users and superusers. <ul> <li><strong><code class="language-plaintext highlighter-rouge">create_user</code></strong>: Creates a user with <code class="language-plaintext highlighter-rouge">institution_id</code>, <code class="language-plaintext highlighter-rouge">role</code>, <code class="language-plaintext highlighter-rouge">phone_number</code>, and <code class="language-plaintext highlighter-rouge">hospital</code>. Automatically sets <code class="language-plaintext highlighter-rouge">is_staff=True</code> if the role is ‘ADMIN’.</li> <li><strong><code class="language-plaintext highlighter-rouge">create_superuser</code></strong>: Creates a superuser, setting <code class="language-plaintext highlighter-rouge">is_staff=True</code> and <code class="language-plaintext highlighter-rouge">is_superuser=True</code>.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">User</code></strong>: <ul> <li>A custom user model based on Django’s <code class="language-plaintext highlighter-rouge">AbstractBaseUser</code> and <code class="language-plaintext highlighter-rouge">PermissionsMixin</code>.</li> <li>Key fields include <code class="language-plaintext highlighter-rouge">institution_id</code> (display ID unique within a hospital), <code class="language-plaintext highlighter-rouge">hospital</code>, <code class="language-plaintext highlighter-rouge">role</code>, <code class="language-plaintext highlighter-rouge">phone_number</code> (unique and validated with a regex for Indian phone numbers), <code class="language-plaintext highlighter-rouge">current_block</code>, <code class="language-plaintext highlighter-rouge">current_ward</code>, <code class="language-plaintext highlighter-rouge">fcm_token</code> and <code class="language-plaintext highlighter-rouge">fcm_token_updated_at</code> for Firebase Cloud Messaging, <code class="language-plaintext highlighter-rouge">current_device</code>, <code class="language-plaintext highlighter-rouge">is_active</code>, <code class="language-plaintext highlighter-rouge">is_logged_in</code>, <code class="language-plaintext highlighter-rouge">is_staff</code>, <code class="language-plaintext highlighter-rouge">is_superuser</code>, <code class="language-plaintext highlighter-rouge">date_joined</code>, and <code class="language-plaintext highlighter-rouge">password_set</code> status.</li> <li>Initially, <code class="language-plaintext highlighter-rouge">institution_id</code> and <code class="language-plaintext highlighter-rouge">hospital</code> were unique together, but this constraint was removed.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">SiteUser</code></strong>: <ul> <li>Represents administrators for the entire MemoTrack system (not hospital-specific).</li> <li>Stores <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">password</code>.</li> <li>The <code class="language-plaintext highlighter-rouge">save</code> method automatically hashes the password using SHA256.</li> <li><code class="language-plaintext highlighter-rouge">check_password</code> verifies a raw password against the stored hash.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">serializers.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">HospitalSerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">Hospital</code> model data, including <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">geolocation_point</code>, <code class="language-plaintext highlighter-rouge">radius</code>, and <code class="language-plaintext highlighter-rouge">address</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">AuthTokenRequestSerializer</code></strong>: Used for login requests, requiring <code class="language-plaintext highlighter-rouge">phone</code> and <code class="language-plaintext highlighter-rouge">password</code>, with an optional <code class="language-plaintext highlighter-rouge">fcm_token</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">UserSerializer</code></strong>: Serialises the <code class="language-plaintext highlighter-rouge">User</code> model, providing read-only fields for <code class="language-plaintext highlighter-rouge">current_block_name</code>, <code class="language-plaintext highlighter-rouge">current_block_id</code>, <code class="language-plaintext highlighter-rouge">current_ward_id</code>, <code class="language-plaintext highlighter-rouge">current_ward_name</code>, <code class="language-plaintext highlighter-rouge">floor</code>, <code class="language-plaintext highlighter-rouge">role</code> name and ID, <code class="language-plaintext highlighter-rouge">hospital_id</code>, and role-based permissions (<code class="language-plaintext highlighter-rouge">is_approver</code>, <code class="language-plaintext highlighter-rouge">is_responder</code>, <code class="language-plaintext highlighter-rouge">is_creator</code>, <code class="language-plaintext highlighter-rouge">is_superuser</code>, <code class="language-plaintext highlighter-rouge">is_staff</code>).</li> <li><strong><code class="language-plaintext highlighter-rouge">AuthTokenResponseSerializer</code></strong>: Used for login responses, providing the authentication <code class="language-plaintext highlighter-rouge">token</code>, and the <code class="language-plaintext highlighter-rouge">user</code> and <code class="language-plaintext highlighter-rouge">hospital</code> data serialised by their respective serializers.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">signals.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">update_admin_staff_status</code></strong>: A <code class="language-plaintext highlighter-rouge">post_save</code> signal receiver for the <code class="language-plaintext highlighter-rouge">User</code> model.</li> <li>If a user’s role name is ‘ADMIN’, it updates all users with that role to have <code class="language-plaintext highlighter-rouge">is_staff=True</code>. If a user’s role is not ‘ADMIN’ and they are staff (but not superuser), their <code class="language-plaintext highlighter-rouge">is_staff</code> status is set to <code class="language-plaintext highlighter-rouge">False</code>.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">tests.py</code></strong>: An empty file, typically reserved for Django unit tests for the <code class="language-plaintext highlighter-rouge">accounts</code> app.</li> <li><strong><code class="language-plaintext highlighter-rouge">urls.py</code></strong>: <ul> <li>Defines URL patterns for administrative login, logout, dashboard, and management pages.</li> <li>Includes endpoints for managing <code class="language-plaintext highlighter-rouge">SiteUser</code> accounts, <code class="language-plaintext highlighter-rouge">Hospital</code> records, and <code class="language-plaintext highlighter-rouge">User</code> accounts within hospitals.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">views.py</code></strong>: <ul> <li>Contains Django views for rendering HTML pages and Django REST Framework <code class="language-plaintext highlighter-rouge">APIView</code> classes for API endpoints.</li> <li><strong>Admin HTML Views</strong>: <code class="language-plaintext highlighter-rouge">admin_login</code>, <code class="language-plaintext highlighter-rouge">admin_logout</code>, <code class="language-plaintext highlighter-rouge">admin_dashboard</code>, <code class="language-plaintext highlighter-rouge">admin_page</code> (for managing site-wide admins), <code class="language-plaintext highlighter-rouge">delete_siteuser</code>, <code class="language-plaintext highlighter-rouge">admin_profile</code>, <code class="language-plaintext highlighter-rouge">hospitals</code> (for managing hospitals), <code class="language-plaintext highlighter-rouge">delete_hospital</code>, <code class="language-plaintext highlighter-rouge">switch_hospital</code> (to switch admin context), <code class="language-plaintext highlighter-rouge">hospital_users</code> (for managing users within a specific hospital), and <code class="language-plaintext highlighter-rouge">delete_hospital_user</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">CustomAuthToken</code> (APIView)</strong>: Handles user authentication with phone number and password. It retrieves or creates an auth token, updates the user’s <code class="language-plaintext highlighter-rouge">is_logged_in</code> status, FCM token, and <code class="language-plaintext highlighter-rouge">last_login</code> timestamp.</li> <li><strong><code class="language-plaintext highlighter-rouge">LogoutView</code> (APIView)</strong>: Logs out the authenticated user. For superusers, it removes their hospital association, while for others, it sets <code class="language-plaintext highlighter-rouge">is_logged_in</code> to <code class="language-plaintext highlighter-rouge">False</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">RefreshUserView</code> (APIView)</strong>: Allows an authenticated user to refresh their user data and token.</li> </ul> </li> </ul> <h4 id="backendaccountsmanagementcommands"> <a href="#backendaccountsmanagementcommands" class="anchor-heading" aria-labelledby="backendaccountsmanagementcommands"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/accounts/management/commands/</code> </h4> <p>This directory contains custom Django management commands for data setup.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">setup_nurses.py</code></strong>: A command to seed nurse users into the database from a specified JSON file. It creates a “Ward Staff Nurse” role if it doesn’t exist and associates users with the first hospital found.</li> <li><strong><code class="language-plaintext highlighter-rouge">setup_users.py</code></strong>: A command to seed a predefined set of roles (e.g., ‘Ward Staff Nurse’, various ‘Approvers’, and ‘Responders’) and users from an embedded JSON string for the first hospital in the system.</li> <li><strong><code class="language-plaintext highlighter-rouge">setup_users_from_json.py</code></strong>: Similar to <code class="language-plaintext highlighter-rouge">setup_nurses.py</code>, but designed to process a JSON file containing nested department data to create nurse users.</li> </ul> <h4 id="backendaccountsmigrations"> <a href="#backendaccountsmigrations" class="anchor-heading" aria-labelledby="backendaccountsmigrations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/accounts/migrations/</code> </h4> <p>This directory contains Django migration files, which track changes to the <code class="language-plaintext highlighter-rouge">accounts</code> app’s database schema over time. Examples include initial model creation, adding/removing fields, and altering unique constraints.</p> <h4 id="backendaccountstemplatesaccounts"> <a href="#backendaccountstemplatesaccounts" class="anchor-heading" aria-labelledby="backendaccountstemplatesaccounts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/accounts/templates/accounts/</code> </h4> <p>This directory contains HTML templates specifically for the <code class="language-plaintext highlighter-rouge">accounts</code> Django app’s web interface.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">admin_dashboard.html</code></strong>: The main dashboard for administrators, providing links to manage site admins, hospitals, and profiles.</li> <li><strong><code class="language-plaintext highlighter-rouge">admin_login.html</code></strong>: The login form for system administrators.</li> <li><strong><code class="language-plaintext highlighter-rouge">admin_page.html</code></strong>: A page for managing (adding/deleting) site-wide admin users.</li> <li><strong><code class="language-plaintext highlighter-rouge">admin_profile.html</code></strong>: A page for administrators to update their profile (username and password).</li> <li><strong><code class="language-plaintext highlighter-rouge">hospital_users.html</code></strong>: A page to view and manage users associated with a specific hospital, allowing addition and deletion of users.</li> <li><strong><code class="language-plaintext highlighter-rouge">hospitals.html</code></strong>: A page to manage (add/delete) hospitals and navigate to manage users within each hospital.</li> </ul> <h3 id="backendapp"> <a href="#backendapp" class="anchor-heading" aria-labelledby="backendapp"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/app/</code> </h3> <p>This directory contains sub-applications related to core functionalities like infrastructure and memos.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">__init__.py</code></strong>: An empty file that signifies the <code class="language-plaintext highlighter-rouge">app</code> directory is a Python package.</li> </ul> <h4 id="backendappinfrastructure"> <a href="#backendappinfrastructure" class="anchor-heading" aria-labelledby="backendappinfrastructure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/app/infrastructure/</code> </h4> <p>This Django app manages hospital infrastructure entities like blocks, wards, and approval hierarchies.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">__init__.py</code></strong>: An empty file.</li> <li><strong><code class="language-plaintext highlighter-rouge">admin.py</code></strong>: An empty file, intended for Django Admin configurations specific to infrastructure models.</li> <li><strong><code class="language-plaintext highlighter-rouge">apps.py</code></strong>: Defines the <code class="language-plaintext highlighter-rouge">InfrastructureConfig</code> for the <code class="language-plaintext highlighter-rouge">app.infrastructure</code> app.</li> <li><strong><code class="language-plaintext highlighter-rouge">models.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">ApproverHierarchy</code></strong>: Defines a sequence of approval levels for memos, indicating if the hierarchy is <code class="language-plaintext highlighter-rouge">is_active</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">ApproverLevel</code></strong>: Represents a specific <code class="language-plaintext highlighter-rouge">Role</code> within an <code class="language-plaintext highlighter-rouge">ApproverHierarchy</code> and its <code class="language-plaintext highlighter-rouge">priority</code> (lower means higher priority).</li> <li><strong><code class="language-plaintext highlighter-rouge">BlockChange</code></strong>: Records when a user changes their <code class="language-plaintext highlighter-rouge">current_block</code>, including <code class="language-plaintext highlighter-rouge">from_block</code>, <code class="language-plaintext highlighter-rouge">to_block</code>, <code class="language-plaintext highlighter-rouge">user</code>, and <code class="language-plaintext highlighter-rouge">changed_at</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">WardChange</code></strong>: Records when a user changes their <code class="language-plaintext highlighter-rouge">current_ward</code>, including <code class="language-plaintext highlighter-rouge">from_ward</code>, <code class="language-plaintext highlighter-rouge">to_ward</code>, <code class="language-plaintext highlighter-rouge">user</code>, and <code class="language-plaintext highlighter-rouge">changed_at</code>.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">permissions.py</code></strong>: Defines custom Django REST Framework permission classes to control access to API endpoints based on user roles and hospital affiliation. <ul> <li><strong><code class="language-plaintext highlighter-rouge">HospitalPermission</code></strong>: Allows safe methods (<code class="language-plaintext highlighter-rouge">GET</code>, <code class="language-plaintext highlighter-rouge">HEAD</code>, <code class="language-plaintext highlighter-rouge">OPTIONS</code>) for all. <code class="language-plaintext highlighter-rouge">PUT</code> and <code class="language-plaintext highlighter-rouge">PATCH</code> are restricted to <code class="language-plaintext highlighter-rouge">superuser</code> or <code class="language-plaintext highlighter-rouge">staff</code>. <code class="language-plaintext highlighter-rouge">DELETE</code> is never allowed.</li> <li><strong><code class="language-plaintext highlighter-rouge">IsHospitalUserOrSuperUser</code></strong>: Allows safe methods for all users. <code class="language-plaintext highlighter-rouge">POST</code> is restricted to <code class="language-plaintext highlighter-rouge">superuser</code>. <code class="language-plaintext highlighter-rouge">PUT</code>/<code class="language-plaintext highlighter-rouge">PATCH</code> and <code class="language-plaintext highlighter-rouge">DELETE</code> are allowed for <code class="language-plaintext highlighter-rouge">superuser</code> or <code class="language-plaintext highlighter-rouge">staff</code> modifying their <em>own</em> hospital.</li> <li><strong><code class="language-plaintext highlighter-rouge">RoleEditPermission</code></strong>: Allows safe methods for all. All methods are allowed for <code class="language-plaintext highlighter-rouge">superuser</code>. <code class="language-plaintext highlighter-rouge">staff</code> can only perform actions on roles within their <em>own</em> hospital.</li> <li><strong><code class="language-plaintext highlighter-rouge">UserPermission</code></strong>: Allows safe methods for all. All methods are allowed for <code class="language-plaintext highlighter-rouge">superuser</code>. <code class="language-plaintext highlighter-rouge">staff</code> can add/edit/delete users within their <em>own</em> hospital. A normal user can <code class="language-plaintext highlighter-rouge">PUT</code>/<code class="language-plaintext highlighter-rouge">PATCH</code> their <em>own</em> profile.</li> <li><strong><code class="language-plaintext highlighter-rouge">WardPermission</code></strong>: Allows safe methods for all. <code class="language-plaintext highlighter-rouge">POST</code> and <code class="language-plaintext highlighter-rouge">DELETE</code> are allowed for <code class="language-plaintext highlighter-rouge">superuser</code> or <code class="language-plaintext highlighter-rouge">staff</code> within their <em>own</em> hospital.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">serializers.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">HospitalSerializer</code></strong>: (Redundant definition, already in <code class="language-plaintext highlighter-rouge">accounts/serializers.py</code>) Serialises Hospital model data.</li> <li><strong><code class="language-plaintext highlighter-rouge">RoleSerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">Role</code> objects, showing the <code class="language-plaintext highlighter-rouge">hospital</code> name, and <code class="language-plaintext highlighter-rouge">is_approver</code>, <code class="language-plaintext highlighter-rouge">is_responder</code>, <code class="language-plaintext highlighter-rouge">is_creator</code>, <code class="language-plaintext highlighter-rouge">is_protected</code> flags.</li> <li><strong><code class="language-plaintext highlighter-rouge">HospitalUserSerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">User</code> objects for hospital-specific contexts. It handles creation of users by associating them with a <code class="language-plaintext highlighter-rouge">Hospital</code> and setting their password.</li> <li><strong><code class="language-plaintext highlighter-rouge">BlockSerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">Blocks</code> model data. It automatically associates new blocks with the <code class="language-plaintext highlighter-rouge">hospital_id</code> from the URL context and sets the <code class="language-plaintext highlighter-rouge">created_by</code> user.</li> <li><strong><code class="language-plaintext highlighter-rouge">ShiftSerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">Shift</code> model data. Similar to <code class="language-plaintext highlighter-rouge">BlockSerializer</code>, it handles hospital association and <code class="language-plaintext highlighter-rouge">created_by</code> user.</li> <li><strong><code class="language-plaintext highlighter-rouge">WardSerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">Ward</code> model data, including its associated <code class="language-plaintext highlighter-rouge">block</code> and <code class="language-plaintext highlighter-rouge">floor</code>. It includes a <code class="language-plaintext highlighter-rouge">validate</code> method to ensure the <code class="language-plaintext highlighter-rouge">floor</code> is within the <code class="language-plaintext highlighter-rouge">block</code>’s <code class="language-plaintext highlighter-rouge">no_of_floors</code> range.</li> <li><strong><code class="language-plaintext highlighter-rouge">ApproverLevelSerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">ApproverLevel</code> objects, exposing <code class="language-plaintext highlighter-rouge">role</code>, <code class="language-plaintext highlighter-rouge">role_name</code>, and <code class="language-plaintext highlighter-rouge">priority</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">ApproverHierarchySerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">ApproverHierarchy</code> objects, including nested <code class="language-plaintext highlighter-rouge">ApproverLevelSerializer</code> for its <code class="language-plaintext highlighter-rouge">levels</code>. It requires at least one level and handles creation and updates of nested levels.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">tests.py</code></strong>: An empty file for infrastructure-related tests.</li> <li><strong><code class="language-plaintext highlighter-rouge">urls.py</code></strong>: <ul> <li>Defines API routes for hospital-related infrastructure using <code class="language-plaintext highlighter-rouge">rest_framework.routers.DefaultRouter</code> and <code class="language-plaintext highlighter-rouge">rest_framework_nested.routers.NestedDefaultRouter</code>.</li> <li>Includes nested routes under <code class="language-plaintext highlighter-rouge">/api/hospitals/</code> for <code class="language-plaintext highlighter-rouge">roles</code>, <code class="language-plaintext highlighter-rouge">users</code>, <code class="language-plaintext highlighter-rouge">shifts</code>, <code class="language-plaintext highlighter-rouge">blocks</code>, <code class="language-plaintext highlighter-rouge">hierarchies</code>, and <code class="language-plaintext highlighter-rouge">wards</code>.</li> <li>Also defines direct paths for <code class="language-plaintext highlighter-rouge">/api/set-password/</code>, <code class="language-plaintext highlighter-rouge">/api/switch-block/</code>, and <code class="language-plaintext highlighter-rouge">/api/switch-ward/</code>.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">views.py</code></strong>: <ul> <li>Contains <code class="language-plaintext highlighter-rouge">viewsets.ModelViewSet</code> classes for various infrastructure models and <code class="language-plaintext highlighter-rouge">APIView</code> classes for specific actions.</li> <li><strong><code class="language-plaintext highlighter-rouge">HospitalViewSet</code></strong>: Manages <code class="language-plaintext highlighter-rouge">Hospital</code> records, using <code class="language-plaintext highlighter-rouge">IsHospitalUserOrSuperUser</code> permissions. It explicitly disallows <code class="language-plaintext highlighter-rouge">DELETE</code> operations.</li> <li><strong><code class="language-plaintext highlighter-rouge">PasswordChangeViewSet</code></strong>: An APIView to allow users to change their password by providing their phone number and new password.</li> <li><strong><code class="language-plaintext highlighter-rouge">RoleViewSet</code></strong>: Manages <code class="language-plaintext highlighter-rouge">Role</code> records within a hospital. It applies <code class="language-plaintext highlighter-rouge">RoleEditPermission</code> and allows filtering roles by their <code class="language-plaintext highlighter-rouge">is_responder</code> status.</li> <li><strong><code class="language-plaintext highlighter-rouge">HospitalUserViewSet</code></strong>: Manages <code class="language-plaintext highlighter-rouge">User</code> records specifically for a given hospital, excluding superusers. It uses <code class="language-plaintext highlighter-rouge">UserPermission</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">BlockViewSet</code></strong>: Manages <code class="language-plaintext highlighter-rouge">Blocks</code> within a hospital. It associates the creating user and hospital with the new block.</li> <li><strong><code class="language-plaintext highlighter-rouge">ShiftViewSet</code></strong>: Manages <code class="language-plaintext highlighter-rouge">Shift</code> records within a hospital, associating the creating user and hospital. It explicitly disallows <code class="language-plaintext highlighter-rouge">DELETE</code> operations.</li> <li><strong><code class="language-plaintext highlighter-rouge">ApproverHierarchyViewSet</code></strong>: Manages <code class="language-plaintext highlighter-rouge">ApproverHierarchy</code> records, filtering by roles within a hospital.</li> <li><strong><code class="language-plaintext highlighter-rouge">WardViewSet</code></strong>: Manages <code class="language-plaintext highlighter-rouge">Ward</code> records. It allows filtering by <code class="language-plaintext highlighter-rouge">block</code> and <code class="language-plaintext highlighter-rouge">floor</code> and supports <strong>soft-deletion</strong> (marking as <code class="language-plaintext highlighter-rouge">deleted=True</code>) and restoring of wards, with permanent deletion only for superusers.</li> <li><strong><code class="language-plaintext highlighter-rouge">SwitchBlock</code> (APIView)</strong>: Allows a user to change their <code class="language-plaintext highlighter-rouge">current_block</code> and logs this change as a <code class="language-plaintext highlighter-rouge">BlockChange</code> event.</li> <li><strong><code class="language-plaintext highlighter-rouge">SwitchWard</code> (APIView)</strong>: Allows a user to change their <code class="language-plaintext highlighter-rouge">current_ward</code>, logs it as a <code class="language-plaintext highlighter-rouge">WardChange</code> event, and automatically updates their <code class="language-plaintext highlighter-rouge">current_block</code> to the ward’s associated block.</li> </ul> </li> </ul> <h4 id="backendappinfrastructuremigrations"> <a href="#backendappinfrastructuremigrations" class="anchor-heading" aria-labelledby="backendappinfrastructuremigrations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/app/infrastructure/migrations/</code> </h4> <p>This directory contains Django migration files for the <code class="language-plaintext highlighter-rouge">app.infrastructure</code> app, tracking database schema changes related to <code class="language-plaintext highlighter-rouge">ApproverHierarchy</code>, <code class="language-plaintext highlighter-rouge">ApproverLevel</code>, <code class="language-plaintext highlighter-rouge">BlockChange</code>, and <code class="language-plaintext highlighter-rouge">WardChange</code> models.</p> <h4 id="backendappmemos"> <a href="#backendappmemos" class="anchor-heading" aria-labelledby="backendappmemos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/app/memos/</code> </h4> <p>This Django app manages memo creation, events, snapshots, and dashboard data.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">__init__.py</code></strong>: An empty file.</li> <li><strong><code class="language-plaintext highlighter-rouge">admin.py</code></strong>: An empty file, intended for Django Admin configurations specific to memo models.</li> <li><strong><code class="language-plaintext highlighter-rouge">apps.py</code></strong>: Defines the <code class="language-plaintext highlighter-rouge">MemosConfig</code> for the <code class="language-plaintext highlighter-rouge">app.memos</code> app. The <code class="language-plaintext highlighter-rouge">ready</code> method ensures <code class="language-plaintext highlighter-rouge">signals</code> are imported.</li> <li><strong><code class="language-plaintext highlighter-rouge">cron_job.py</code></strong>: Contains functions for precomputing dashboard data for performance. <ul> <li><strong><code class="language-plaintext highlighter-rouge">get_card_metrics(data)</code></strong>: Calculates overall memo statistics like total, completed, completion rate, average resolution time, and fastest responder.</li> <li><strong><code class="language-plaintext highlighter-rouge">get_block_ward_heatmap(data)</code></strong>: Generates counts of memos per block and ward for heatmaps.</li> <li><strong><code class="language-plaintext highlighter-rouge">get_responder_resolution(data)</code></strong>: Calculates the average resolution time for each responder role.</li> <li><strong><code class="language-plaintext highlighter-rouge">get_status_pie(data)</code></strong>: Categorises memos into ‘completed’, ‘rejected’, and ‘ongoing’ statuses.</li> <li><strong><code class="language-plaintext highlighter-rouge">get_approval_flow(data)</code></strong>: Tracks the approval status of memos across predefined hierarchy levels (e.g., Ward Superintendent, RMO, DEAN).</li> <li><strong><code class="language-plaintext highlighter-rouge">get_department_distribution(data)</code></strong>: Counts memos per department.</li> <li><strong><code class="language-plaintext highlighter-rouge">get_completion_timeline(data)</code></strong>: Categorizes memo completion times into buckets (e.g., 0-2h, 2-6h, Over 6h).</li> <li><strong><code class="language-plaintext highlighter-rouge">precompute_dashboard_data_and_save(hospital_id=None)</code></strong>: Generates and saves dashboard data as JSON files (e.g., <code class="language-plaintext highlighter-rouge">hospital_id_YYYY-MM-DD.json</code>) for specific hospitals or all combined, for ‘today’, ‘week’, and ‘month’ periods. Files are stored in <code class="language-plaintext highlighter-rouge">settings.MEDIA_ROOT/dashboard/</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">precompute_all_hospitals_dashboard_data()</code></strong>: Triggers the precomputation process for all hospitals in the system.</li> <li><strong><code class="language-plaintext highlighter-rouge">get_hospital_dashboard_data(hospital_id, period)</code></strong>: Retrieves the precomputed dashboard data from the saved JSON files for a given hospital and period (<code class="language-plaintext highlighter-rouge">today</code>, <code class="language-plaintext highlighter-rouge">week</code>, or <code class="language-plaintext highlighter-rouge">month</code>).</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">models.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">Memo</code></strong>: The central model for a memo, identified by a <code class="language-plaintext highlighter-rouge">memoId</code> (UUID). It tracks <code class="language-plaintext highlighter-rouge">hospital</code> association, <code class="language-plaintext highlighter-rouge">is_deleted</code>, <code class="language-plaintext highlighter-rouge">is_merged</code>, <code class="language-plaintext highlighter-rouge">created_at</code>, and <code class="language-plaintext highlighter-rouge">modified_at</code>. It has a <code class="language-plaintext highlighter-rouge">latest_snapshot</code> method to retrieve the most recent state.</li> <li><strong><code class="language-plaintext highlighter-rouge">MemoEvents</code></strong>: Records every significant event related to a <code class="language-plaintext highlighter-rouge">Memo</code> (e.g., ‘created’, ‘updated’, ‘deleted’, ‘approved’, ‘rejected’, ‘attended’, ‘completed’, ‘tagged’). Each event is associated with a <code class="language-plaintext highlighter-rouge">memo</code>, <code class="language-plaintext highlighter-rouge">event_by</code> user, and includes <code class="language-plaintext highlighter-rouge">payload</code> and <code class="language-plaintext highlighter-rouge">metadata</code> JSON fields.</li> <li><strong><code class="language-plaintext highlighter-rouge">MemoSnapshot</code></strong>: Stores a immutable snapshot of a memo’s state at a particular <code class="language-plaintext highlighter-rouge">timestamp</code>. It includes <code class="language-plaintext highlighter-rouge">info</code> (contextual data about the memo and user), <code class="language-plaintext highlighter-rouge">hierarchy</code> (approval structure), <code class="language-plaintext highlighter-rouge">approval_history</code>, <code class="language-plaintext highlighter-rouge">worker_status</code> (list of work updates), <code class="language-plaintext highlighter-rouge">attendee_otp</code>, and <code class="language-plaintext highlighter-rouge">completion_otp</code>. It has methods <code class="language-plaintext highlighter-rouge">refresh_otp</code> and <code class="language-plaintext highlighter-rouge">generate_otp</code> to create one-time passwords.</li> <li><strong><code class="language-plaintext highlighter-rouge">AttendeeETA</code></strong>: Tracks the estimated time of arrival (<code class="language-plaintext highlighter-rouge">eta</code>) for a <code class="language-plaintext highlighter-rouge">User</code> (<code class="language-plaintext highlighter-rouge">attendee</code>) regarding a specific <code class="language-plaintext highlighter-rouge">Memo</code>. It also records <code class="language-plaintext highlighter-rouge">created_at</code>, <code class="language-plaintext highlighter-rouge">updated_at</code>, and <code class="language-plaintext highlighter-rouge">updated_count</code> for ETA changes.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">serializers.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">MemoSerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">MemoSnapshot</code> data to provide a summary view, showing <code class="language-plaintext highlighter-rouge">memoId</code>, <code class="language-plaintext highlighter-rouge">created_at</code>, and <code class="language-plaintext highlighter-rouge">latest_snapshot</code> info.</li> <li><strong><code class="language-plaintext highlighter-rouge">MemoCreateSerializer</code></strong>: Used to create a new <code class="language-plaintext highlighter-rouge">Memo</code> instance and log its initial ‘created’ event. It also includes a <code class="language-plaintext highlighter-rouge">delete</code> method for soft-deleting memos.</li> <li><strong><code class="language-plaintext highlighter-rouge">MemoSnapshotSerializer</code></strong>: A comprehensive serializer for <code class="language-plaintext highlighter-rouge">MemoSnapshot</code>, exposing all its fields including OTPs.</li> <li><strong><code class="language-plaintext highlighter-rouge">AttendeeETASerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">AttendeeETA</code> instances, showing <code class="language-plaintext highlighter-rouge">attendee</code> ID and name, <code class="language-plaintext highlighter-rouge">memo</code> ID, <code class="language-plaintext highlighter-rouge">eta</code>, and tracking fields.</li> <li><strong><code class="language-plaintext highlighter-rouge">MemoEventsSerializer</code></strong>: Serialises <code class="language-plaintext highlighter-rouge">MemoEvents</code> instances.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">signals.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">create_memo_snapshot</code></strong>: A <code class="language-plaintext highlighter-rouge">post_save</code> signal receiver for <code class="language-plaintext highlighter-rouge">MemoEvents</code>.</li> <li>It creates a new <code class="language-plaintext highlighter-rouge">MemoSnapshot</code> for most event types, capturing the memo’s state and user context at that moment.</li> <li><strong>Special handling for events</strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">worker_status_delete</code></strong>: Updates the latest snapshot to mark a specific worker status entry as deleted.</li> <li><strong><code class="language-plaintext highlighter-rouge">updated</code></strong>: Modifies the <code class="language-plaintext highlighter-rouge">info</code> field of the <em>latest</em> existing snapshot instead of creating a new one.</li> <li><strong><code class="language-plaintext highlighter-rouge">approved</code> / <code class="language-plaintext highlighter-rouge">rejected</code></strong>: Updates the <code class="language-plaintext highlighter-rouge">hierarchy</code> and <code class="language-plaintext highlighter-rouge">approval_history</code> in the <em>latest</em> snapshot to reflect the approval/rejection status by the specific role.</li> <li><strong><code class="language-plaintext highlighter-rouge">attended</code> / <code class="language-plaintext highlighter-rouge">completed</code> / <code class="language-plaintext highlighter-rouge">incomplete</code> / <code class="language-plaintext highlighter-rouge">tagged</code></strong>: Appends new entries to the <code class="language-plaintext highlighter-rouge">worker_status</code> list in the latest snapshot. If the event is <code class="language-plaintext highlighter-rouge">completed</code>, it also updates the memo’s overall <code class="language-plaintext highlighter-rouge">status</code> in the <code class="language-plaintext highlighter-rouge">info</code> field. <code class="language-plaintext highlighter-rouge">tagged</code> events trigger <code class="language-plaintext highlighter-rouge">memo_tagged_notification</code>.</li> </ul> </li> <li>For <code class="language-plaintext highlighter-rouge">created</code> events, it populates the snapshot <code class="language-plaintext highlighter-rouge">info</code> with user context (role, block, ward, floor) and memo details (complaint, department, tagged role). It also applies the currently <code class="language-plaintext highlighter-rouge">is_active</code> <code class="language-plaintext highlighter-rouge">ApproverHierarchy</code> to the snapshot. <code class="language-plaintext highlighter-rouge">memo_created_notification</code> is triggered for new memos.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">tests.py</code></strong>: An empty file for memo-related tests.</li> <li><strong><code class="language-plaintext highlighter-rouge">urls.py</code></strong>: Defines URL patterns for memo API endpoints, including: <ul> <li><code class="language-plaintext highlighter-rouge">create-memo/</code>.</li> <li><code class="language-plaintext highlighter-rouge">memos/</code> (list user memos).</li> <li><code class="language-plaintext highlighter-rouge">memos/&lt;memoId&gt;/</code> (memo detail and update).</li> <li><code class="language-plaintext highlighter-rouge">memos/&lt;memoId&gt;/approve/</code> and <code class="language-plaintext highlighter-rouge">reject/</code>.</li> <li><code class="language-plaintext highlighter-rouge">memos/&lt;memoId&gt;/work-status/</code> (for worker updates and deletion).</li> <li><code class="language-plaintext highlighter-rouge">memos/&lt;memoId&gt;/attendee-eta/</code> (for ETA management).</li> <li><code class="language-plaintext highlighter-rouge">memos/&lt;memoId&gt;/refresh-otp/</code> (to generate new OTPs).</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">views.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">CreateMemoView</code></strong>: Handles the creation of new memos and their initial <code class="language-plaintext highlighter-rouge">MemoSnapshot</code>, logging a ‘created’ event.</li> <li><strong><code class="language-plaintext highlighter-rouge">ListUserMemosView</code></strong>: Provides structured lists of memos based on the requesting user’s role (<code class="language-plaintext highlighter-rouge">creator</code>, <code class="language-plaintext highlighter-rouge">approver</code>, <code class="language-plaintext highlighter-rouge">responder</code>, or <code class="language-plaintext highlighter-rouge">admin</code>), fetching the latest snapshots for each memo and categorising them accordingly (e.g., ‘My Memos’, ‘Under Review’, ‘Open Memos’, ‘Completed’, ‘Deleted Memos’).</li> <li><strong><code class="language-plaintext highlighter-rouge">MemoDetailView</code></strong>: Retrieves the latest snapshot of a specific memo. It also handles <code class="language-plaintext highlighter-rouge">PATCH</code> requests to update a memo’s details by logging an ‘updated’ event.</li> <li><strong><code class="language-plaintext highlighter-rouge">MemoApproveView</code></strong>: Allows an authenticated user to approve a memo by logging an ‘approved’ event.</li> <li><strong><code class="language-plaintext highlighter-rouge">MemoRejectView</code></strong>: Allows an authenticated user to reject a memo by logging a ‘rejected’ event.</li> <li><strong><code class="language-plaintext highlighter-rouge">AttendeeETACreateView</code></strong>: Provides API endpoints to view all existing ETAs for a memo, create a new ETA, or update the current user’s ETA for a memo.</li> <li><strong><code class="language-plaintext highlighter-rouge">MemoWorkStatusView</code></strong>: Handles <code class="language-plaintext highlighter-rouge">POST</code> requests for adding worker status updates (e.g., ‘attended’, ‘completed’, ‘incomplete’, ‘tagged’) to a memo. It includes OTP verification for ‘attended’, ‘incomplete’, ‘tagged’, and ‘completed’ statuses. It also handles <code class="language-plaintext highlighter-rouge">DELETE</code> requests to soft-delete a specific worker status entry by logging a <code class="language-plaintext highlighter-rouge">worker_status_delete</code> event.</li> <li><strong><code class="language-plaintext highlighter-rouge">RefreshOTPView</code></strong>: Allows refreshing the <code class="language-plaintext highlighter-rouge">attendee_otp</code> and <code class="language-plaintext highlighter-rouge">completion_otp</code> for a memo’s latest snapshot.</li> </ul> </li> </ul> <h4 id="backendappmemosmanagementcommands"> <a href="#backendappmemosmanagementcommands" class="anchor-heading" aria-labelledby="backendappmemosmanagementcommands"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/app/memos/management/commands/</code> </h4> <p>This directory contains custom Django management commands for memo-related tasks.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">generate_dashboard_data.py</code></strong>: A management command that triggers the <code class="language-plaintext highlighter-rouge">precompute_all_hospitals_dashboard_data</code> function from <code class="language-plaintext highlighter-rouge">cron_job.py</code> to generate precomputed dashboard data files.</li> </ul> <h4 id="backendappmemosmigrations"> <a href="#backendappmemosmigrations" class="anchor-heading" aria-labelledby="backendappmemosmigrations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/app/memos/migrations/</code> </h4> <p>This directory contains Django migration files for the <code class="language-plaintext highlighter-rouge">app.memos</code> app, tracking database schema changes related to <code class="language-plaintext highlighter-rouge">Memo</code>, <code class="language-plaintext highlighter-rouge">MemoEvents</code>, <code class="language-plaintext highlighter-rouge">MemoSnapshot</code>, and <code class="language-plaintext highlighter-rouge">AttendeeETA</code> models.</p> <h3 id="backendcore"> <a href="#backendcore" class="anchor-heading" aria-labelledby="backendcore"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/core/</code> </h3> <p>This directory contains the core Django project configuration.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">__init__.py</code></strong>: An empty file.</li> <li><strong><code class="language-plaintext highlighter-rouge">asgi.py</code></strong>: The ASGI (Asynchronous Server Gateway Interface) configuration for the project, used for asynchronous Python web servers.</li> <li><strong><code class="language-plaintext highlighter-rouge">settings.py</code></strong>: The main Django project settings file. <ul> <li><strong><code class="language-plaintext highlighter-rouge">BASE_DIR</code></strong>: Defines the base directory of the project.</li> <li><strong><code class="language-plaintext highlighter-rouge">SECRET_KEY</code></strong>: A unique key for cryptographic signing.</li> <li><strong><code class="language-plaintext highlighter-rouge">DEBUG</code></strong>: Set to <code class="language-plaintext highlighter-rouge">True</code> for development.</li> <li><strong><code class="language-plaintext highlighter-rouge">ALLOWED_HOSTS</code></strong>: Specifies hostnames the Django project can serve, including <code class="language-plaintext highlighter-rouge">'*'</code> for development and specific production URLs.</li> <li><strong><code class="language-plaintext highlighter-rouge">AUTHENTICATION_BACKENDS</code></strong>: Lists authentication backends, including Django’s <code class="language-plaintext highlighter-rouge">ModelBackend</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">INSTALLED_APPS</code></strong>: Lists all active Django applications, including <code class="language-plaintext highlighter-rouge">accounts</code>, <code class="language-plaintext highlighter-rouge">management</code>, <code class="language-plaintext highlighter-rouge">app.infrastructure</code>, <code class="language-plaintext highlighter-rouge">app.memos</code>, and various Django/DRF/CORS related apps.</li> <li><strong><code class="language-plaintext highlighter-rouge">AUTH_USER_MODEL</code></strong>: Specifies the custom user model (<code class="language-plaintext highlighter-rouge">accounts.User</code>).</li> <li><strong><code class="language-plaintext highlighter-rouge">REST_FRAMEWORK</code></strong>: Configures Django REST Framework, including default schema class, authentication classes (<code class="language-plaintext highlighter-rouge">TokenAuthentication</code>, <code class="language-plaintext highlighter-rouge">SessionAuthentication</code>), permission classes (<code class="language-plaintext highlighter-rouge">IsAuthenticated</code>), and filter backends.</li> <li><strong><code class="language-plaintext highlighter-rouge">MIDDLEWARE</code></strong>: Defines the order of middleware components, including <code class="language-plaintext highlighter-rouge">CorsMiddleware</code> and custom <code class="language-plaintext highlighter-rouge">OriginLoggerMiddleware</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">ROOT_URLCONF</code></strong>: Points to the main URL configuration file (<code class="language-plaintext highlighter-rouge">core.urls</code>).</li> <li><strong><code class="language-plaintext highlighter-rouge">TEMPLATES</code></strong>: Configures Django’s templating engine, including <code class="language-plaintext highlighter-rouge">DIRS</code> for shared templates and <code class="language-plaintext highlighter-rouge">APP_DIRS</code> for app-specific templates.</li> <li><strong><code class="language-plaintext highlighter-rouge">WSGI_APPLICATION</code></strong>: The WSGI (Web Server Gateway Interface) configuration for the project.</li> <li><strong><code class="language-plaintext highlighter-rouge">DATABASES</code></strong>: Configures the database connection, currently set up for MySQL using environment variables for credentials.</li> <li><strong><code class="language-plaintext highlighter-rouge">AUTH_PASSWORD_VALIDATORS</code></strong>: Defines password validation rules.</li> <li><strong><code class="language-plaintext highlighter-rouge">TIME_ZONE</code></strong>: Set to <code class="language-plaintext highlighter-rouge">Asia/Kolkata</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">STATIC_URL</code></strong>: URL prefix for static files.</li> <li><strong><code class="language-plaintext highlighter-rouge">SPECTACULAR_SETTINGS</code></strong>: Configures DRF Spectacular for API documentation generation.</li> <li><strong>CORS Settings</strong>: <code class="language-plaintext highlighter-rouge">CSRF_TRUSTED_ORIGINS</code>, <code class="language-plaintext highlighter-rouge">CORS_ALLOWED_ORIGINS</code>, <code class="language-plaintext highlighter-rouge">CORS_ALLOW_CREDENTIALS</code>, <code class="language-plaintext highlighter-rouge">CORS_ALLOW_ALL_ORIGINS</code>, <code class="language-plaintext highlighter-rouge">CORS_ALLOW_HEADERS</code>, <code class="language-plaintext highlighter-rouge">CORS_ALLOWED_METHODS</code> are configured to handle cross-origin requests, including specific domains for frontend and development purposes.</li> <li><strong><code class="language-plaintext highlighter-rouge">MEDIA_URL</code> and <code class="language-plaintext highlighter-rouge">MEDIA_ROOT</code></strong>: Define settings for serving user-uploaded media files.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">urls.py</code></strong>: <ul> <li>The main URL configuration for the entire Django project.</li> <li>Includes URLs for Django Admin, <code class="language-plaintext highlighter-rouge">accounts</code> app, <code class="language-plaintext highlighter-rouge">app.infrastructure</code> app, and <code class="language-plaintext highlighter-rouge">app.memos</code> app.</li> <li>Includes custom API authentication and user refresh endpoints.</li> <li>Integrates DRF Spectacular for API schema, Swagger UI, and ReDoc documentation interfaces.</li> <li>Serves media files during development.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">wsgi.py</code></strong>: The WSGI configuration for the project, used for synchronous Python web servers.</li> </ul> <h4 id="backendcoremiddleware"> <a href="#backendcoremiddleware" class="anchor-heading" aria-labelledby="backendcoremiddleware"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/core/middleware/</code> </h4> <p>This directory contains custom Django middleware.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">__init__.py</code></strong>: An empty file.</li> <li><strong><code class="language-plaintext highlighter-rouge">origin_logger.py</code></strong>: Defines <code class="language-plaintext highlighter-rouge">OriginLoggerMiddleware</code>, a custom middleware that logs the <code class="language-plaintext highlighter-rouge">HTTP_ORIGIN</code>, <code class="language-plaintext highlighter-rouge">HTTP_REFERER</code>, and <code class="language-plaintext highlighter-rouge">HTTP_USER_AGENT</code> headers for every incoming request.</li> </ul> <h3 id="backendmanagement"> <a href="#backendmanagement" class="anchor-heading" aria-labelledby="backendmanagement"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/management/</code> </h3> <p>This Django app is for managing general hospital-related data like blocks and shifts.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">__init__.py</code></strong>: An empty file.</li> <li><strong><code class="language-plaintext highlighter-rouge">admin.py</code></strong>: Configures Django Admin to display <code class="language-plaintext highlighter-rouge">Blocks</code> and <code class="language-plaintext highlighter-rouge">Shift</code> models, ensuring that non-superuser admins only see data relevant to their hospital.</li> <li><strong><code class="language-plaintext highlighter-rouge">apps.py</code></strong>: Defines the <code class="language-plaintext highlighter-rouge">ManagementConfig</code> for the <code class="language-plaintext highlighter-rouge">management</code> app.</li> <li><strong><code class="language-plaintext highlighter-rouge">models.py</code></strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">Blocks</code></strong>: <ul> <li>Represents a building block or section within a hospital.</li> <li>Fields include <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">no_of_floors</code>, <code class="language-plaintext highlighter-rouge">hospital</code>, <code class="language-plaintext highlighter-rouge">created_by</code>, <code class="language-plaintext highlighter-rouge">created_at</code>, and <code class="language-plaintext highlighter-rouge">updated_at</code>.</li> <li>It enforces uniqueness of <code class="language-plaintext highlighter-rouge">name</code> within each <code class="language-plaintext highlighter-rouge">hospital</code>.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">Ward</code></strong>: <ul> <li>Represents a ward, associated with a <code class="language-plaintext highlighter-rouge">Blocks</code> instance.</li> <li>Fields include <code class="language-plaintext highlighter-rouge">ward_name</code>, <code class="language-plaintext highlighter-rouge">block</code>, <code class="language-plaintext highlighter-rouge">floor</code>, <code class="language-plaintext highlighter-rouge">deleted</code> (for soft-deletion), <code class="language-plaintext highlighter-rouge">created_at</code>, <code class="language-plaintext highlighter-rouge">created_by</code>, and <code class="language-plaintext highlighter-rouge">updated_at</code>.</li> <li>The <code class="language-plaintext highlighter-rouge">clean</code> method provides validation to ensure the <code class="language-plaintext highlighter-rouge">floor</code> number is valid for the associated <code class="language-plaintext highlighter-rouge">block</code>.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">Shift</code></strong>: <ul> <li>Represents work shifts within a hospital.</li> <li>Fields include <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">start_time</code>, <code class="language-plaintext highlighter-rouge">end_time</code>, <code class="language-plaintext highlighter-rouge">hospital</code>, <code class="language-plaintext highlighter-rouge">created_by</code>, <code class="language-plaintext highlighter-rouge">created_at</code>, and <code class="language-plaintext highlighter-rouge">updated_at</code>.</li> <li>It enforces uniqueness of <code class="language-plaintext highlighter-rouge">name</code> within each <code class="language-plaintext highlighter-rouge">hospital</code>.</li> </ul> </li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">tests.py</code></strong>: An empty file for management-related tests.</li> <li><strong><code class="language-plaintext highlighter-rouge">views.py</code></strong>: An empty file, intended for management-related views.</li> </ul> <h4 id="backendmanagementmigrations"> <a href="#backendmanagementmigrations" class="anchor-heading" aria-labelledby="backendmanagementmigrations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/management/migrations/</code> </h4> <p>This directory contains Django migration files for the <code class="language-plaintext highlighter-rouge">management</code> app, tracking database schema changes related to <code class="language-plaintext highlighter-rouge">Blocks</code>, <code class="language-plaintext highlighter-rouge">Shift</code>, and <code class="language-plaintext highlighter-rouge">Ward</code> models.</p> <h3 id="backendtemplates"> <a href="#backendtemplates" class="anchor-heading" aria-labelledby="backendtemplates"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">backend/templates/</code> </h3> <p>This directory contains general HTML templates used across the Django project.</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">base.html</code></strong>: A base HTML template that provides a common structure for other pages, including a header with “Memotrack” branding and navigation links (Dashboard, Site Admins, Hospitals, Profile, Logout).</li> <li><strong><code class="language-plaintext highlighter-rouge">error.html</code></strong>: A template designed to display error messages, with a “Go Back” button.</li> <li><strong><code class="language-plaintext highlighter-rouge">accounts/password_setup.html</code></strong>: An empty file, suggesting it might be a placeholder for a password setup/reset page.</li> </ul> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
